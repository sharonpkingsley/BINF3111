<!-- extend base layout -->
{% extends "base.html" %}

{% block content %}

<style>
    #cy {
        width: 55%;
        height: 60%;
        top: 15%;
        left: 20%;
    }
    #table {
        top: 85%;
    }
</style>

<div id='result' class='container'>
         
    <h1>Result</h1>
    
    <div class="container">
            <div id="cy">
                
                <script>
                   
                    var querynode = '{{ querynode }}';
                    
                    var tab = document.getElementById('cy');
                    var cy = cytoscape({
                        container: document.getElementById('cy'),
                        layout: 'concentric',
                        style: [
                            {
                                selector: 'node',
                                style: {
                                    
                                    label: 'data(id)'


                                }
                            },
                            {
                                selector: 'edge',
                                style: {
                                    'width': 1.5,
                                    'line-color': 'black',
                                    'curve-style': 'bezier',
                                    'control-point-step-size': '10',
                                    
                                }
                            },
                            {
                                selector: "edge[id *= 'target']",
                                css: {
                                    'line-color': 'yellow'
                                }
                            },
                            {
                                selector: "edge[id *= 'pathway']",
                                css: {
                                    'line-color': 'blue'
                                }
                            },
                            {
                                selector: "edge[id *= 'struct']",
                                css: {
                                    'line-color': 'green'
                                }
                            }

                        ],
                        elements: [
                        ]
                    });
                    var nodes = {{ nodes|safe }};
                    var score = {{ score|safe }}
                   
                    
                    cy.add([
                        { data: { id: querynode } }
                    ]);
                    for (var i = 0; i < nodes.length; i++) {
                        
                        cy.add({
                                data: { id: nodes[i] }
                            }
                        );
                        
                        cy.add({
                                data: {
                                id: 'edge' + i,
                                source: nodes[i],
                                target: querynode,
                                weight: score[i]
                            }

                        });

                    }
                    var target = {{ target|safe }}
                    var struct = {{ struct|safe }}
                    var pathway = {{ pathway|safe }}
                    var targetsc = {{ targetsc|safe }}
                    var structsc = {{ structsc|safe }}
                    var pathwaysc = {{ pathwaysc|safe }}
                    for (var i = 0; i < target.length; i++) {
                        cy.add([
                            {
                                data: {
                                    id: target[i] + querynode + 'target',
                                    source: querynode,
                                    target: target[i],
                                    weight: targetsc[i]
                                }
                            }
                        ]);

                    }
                    for (var i = 0; i < pathway.length; i++) {
                        cy.add([
                           {
                                data: {
                                    id: pathway[i] + querynode + 'pathway',
                                    source: querynode,
                                    target: pathway[i],
                                    weight: pathwaysc[i]
                                }
                            }
                        ]);

                    }
                    for (var i = 0; i < struct.length; i++) {
                        cy.add([
                            {
                                    data: {
                                    id: struct[i] + querynode + 'struct',
                                    source: querynode,
                                    target: struct[i],
                                    weight: structsc[i]
                                }
                            }
                        ]);

                    }


                    cy.layout({
                        name: 'cose',
                        idealEdgeLength: function (edge) {
                            // Default is: 10
                            // Instead, base it on "weight"
                            return edge.data().weight * 100
                        },
                        nodeOverlap: 20,
                        refresh: 20,
                        fit: true,
                        padding: 30,
                        randomize: false,
                        componentSpacing: 100,
                        nodeRepulsion: 400000,
                        edgeElasticity: 100,
                        nestingFactor: 5,
                        gravity: 80,
                        numIter: 1000,
                        initialTemp: 200,
                        coolingFactor: 0.95,
                        minTemp: 1.0
                    }).run();

                    
                    
                </script>
        </div>
    </div>
    {% if img == "tpc" %}
    <p>
        <img src="{{url_for('static', filename='STPC.jpg')}}" style="height:50px;" />
    </p>
    {% endif %}
    {% if img == "tp" %}
    <p>
        <img src="{{url_for('static', filename='STP.jpg')}}" style="height:50px;" />
    </p>
    {% endif %}
    {% if img == "tc" %}
    <p>
        <img src="{{url_for('static', filename='STC.jpg')}}" style="height:50px;" />
    </p>
    {% endif %}
    {% if img == "t" %}
    <p>
        <img src="{{url_for('static', filename='ST.jpg')}}" style="height:50px;" />
    </p>
    {% endif %}
    {% if img == "pc" %}
    <p>
        <img src="{{url_for('static', filename='SPC.jpg')}}" style="height:50px;" />
    </p>
    {% endif %}
    {% if img == "p" %}
    <p>
        <img src="{{url_for('static', filename='SP.jpg')}}" style="height:50px;" />
    </p>
    {% endif %}
    {% if img == "c" %}
    <p>
        <img src="{{url_for('static', filename='SC.jpg')}}" style="height:50px;" />
    </p>
    {% endif %}
   
    <div id="table">
        <p>
            {% for table in tables %}
            <h3>{{titles[loop.index]}}</h3>
            {{ table|safe }}
            {% endfor %}
        </p>

        <form method="Post">
            <button type="submit" name="submit" class="btn btn-default">
                <span class="glyphicon glyphicon-download"></span> Download
            </button>
        </form>
        <a href="/search" class="btn btn-default">
            <span class="glyphicon glyphicon-search"></span> Search More...
        </a>
    </div>
</div>


{% endblock %}
